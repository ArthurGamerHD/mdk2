<?xml version="1.0" encoding="utf-8"?>
<Project>
    <PropertyGroup>
        <MdkMinifier>none</MdkMinifier>
        <MdkTrim>off</MdkTrim>
        <MdkInteractive>on</MdkInteractive>
        <MdkOutput>auto</MdkOutput>
        <MdkBuildConfiguration>all</MdkBuildConfiguration>
        <MdkArguments />
    </PropertyGroup>
    
    <ItemGroup>
        <None Include="**\*.ini" />
    </ItemGroup>

    <Target Name="MdkPackPrepare">
        <PropertyGroup>
            <MdkRestoreArgumentsList>&quot;$(MSBuildProjectFullPath)&quot;</MdkRestoreArgumentsList>
            <MdkArgumentsList>&quot;$(MSBuildProjectFullPath)&quot; -minifier $(MdkMinifier) -output &quot;$(MdkOutput)&quot;</MdkArgumentsList>
        </PropertyGroup>

        <PropertyGroup Condition="'$(MdkTrim)' == 'on'">
            <MdkArgumentsList>$(MdkArgumentsList) -trim</MdkArgumentsList>
        </PropertyGroup>

        <PropertyGroup Condition="'$(MdkInteractive)' == 'on'">
            <MdkRestoreArgumentsList>$(MdkRestoreArgumentsList) -interactive</MdkRestoreArgumentsList>
            <MdkArgumentsList>$(MdkArgumentsList) -interactive </MdkArgumentsList>
        </PropertyGroup>
        
        <PropertyGroup>
            <MdkArgumentsList>$(MdkArgumentsList) $(MdkArguments) -configuration $(Configuration)</MdkArgumentsList>
        </PropertyGroup>
    </Target>
    
    <Target Name="MdkRestore" DependsOnTargets="MdkPackPrepare" BeforeTargets="PreBuildEvent" Condition="'$(Configuration)' == '$(MdkBuildConfiguration)' Or '$(MdkBuildConfiguration)' == 'all'">
        <Exec Command="&quot;$(MSBuildThisFileDirectory)..\tools\mdk.exe&quot; restore $(MdkRestoreArgumentsList)" />
    </Target>
    
    <Target Name="MdkPack" DependsOnTargets="MdkPackPrepare" AfterTargets="PostBuildEvent" Condition="'$(Configuration)' == '$(MdkBuildConfiguration)' Or '$(MdkBuildConfiguration)' == 'all'">
        <Exec Command="&quot;$(MSBuildThisFileDirectory)..\tools\mdk.exe&quot; pack $(MdkArgumentsList)" />
    </Target>
    
    <Target Name="MdkDidNotPack" DependsOnTargets="MdkPackPrepare" AfterTargets="PostBuildEvent" Condition="'$(Configuration)' != '$(MdkBuildConfiguration)' And '$(MdkBuildConfiguration)' != 'all'">
        <Exec Command="echo MDK did not pack, because the current configuration is '$(Configuration)', not '$(MdkBuildConfiguration)'." />
    </Target>   

</Project>